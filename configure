#!/bin/bash

#
# Author: Vincenzo Maffione <v.maffione@nextworks.it>
#

function usage()
{
	echo "help: configure INSTALLPATH VMIMGPATH"
}

INSTALLPATH=/home/vmaffione/irati/local
VMIMGPATH=/home/vmaffione/git/vm/irati.qcow2

usage

if [ -n "$1" ]; then
	INSTALLPATH=$1
fi

if [ -n "$2" ]; then
	VMIMGPATH=$2
fi

if [ ! -f $VMIMGPATH ]; then
    echo "Error: VM image $VMIMGPATH does not exist"
    exit 1
fi

echo "INSTALLPATH = $INSTALLPATH"
echo "VMIMGPATH = $VMIMGPATH"

sed "s|INSTALLPATH|$INSTALLPATH|g" in.template.conf > template.conf

sed "s|VMIMGPATH|$VMIMGPATH|g" in.update_vm.sh > update_vm.sh

sed "s|INSTALLPATH|$INSTALLPATH|g" in.enroll.py > enroll.py
chmod +x enroll.py

chmod +x gen.py

echo "Configured."
